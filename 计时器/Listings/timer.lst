C51 COMPILER V9.54   TIMER                                                                 10/03/2025 11:49:26 PAGE 1   


C51 COMPILER V9.54, COMPILATION OF MODULE TIMER
OBJECT MODULE PLACED IN .\Objects\timer.obj
COMPILER INVOKED BY: D:\keil\C51\BIN\C51.EXE timer.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND PRINT(.\Listings\timer.
                    -lst) TABS(2) OBJECT(.\Objects\timer.obj)

line level    source

   1          #include "timer.h"
   2          #include "lcd1602.h"
   3          
   4          // 时间变量
   5          unsigned char hour = 0;
   6          unsigned char minute = 0;
   7          unsigned char second = 0;
   8          
   9          // 时间更新标志
  10          bit time_update = 0;
  11          
  12          // 定时器计数变量
  13          unsigned int timer_count = 0;
  14          
  15          // 定时器0初始化
  16          void Timer0_Init(void)
  17          {
  18   1          TMOD &= 0xF0;    // 清除T0的设置
  19   1          TMOD |= 0x01;    // 设置T0为模式1（16位定时器）
  20   1          
  21   1          // 计算12MHz下50ms的初值
  22   1          // 定时器计数 = 65536 - (50000) = 15536 = 0x3CB0
  23   1          TH0 = (65536 - 50000) / 256;
  24   1          TL0 = (65536 - 50000) % 256;
  25   1          
  26   1          ET0 = 1;    // 允许T0中断
  27   1          EA = 1;     // 开启总中断
  28   1      }
  29          
  30          // 启动定时器0
  31          void Timer0_Start(void)
  32          {
  33   1          TR0 = 1;
  34   1      }
  35          
  36          // 停止定时器0
  37          void Timer0_Stop(void)
  38          {
  39   1          TR0 = 0;
  40   1      }
  41          
  42          // 定时器0中断服务函数
  43          void Timer0_ISR(void) interrupt 1
  44          {
  45   1          // 重新装载初值
  46   1          TH0 = (65536 - 50000) / 256;
  47   1          TL0 = (65536 - 50000) % 256;
  48   1          
  49   1          timer_count++;
  50   1          
  51   1          // 50ms * 20 = 1000ms = 1s
  52   1          if(timer_count >= 20)
  53   1          {
  54   2              timer_count = 0;
C51 COMPILER V9.54   TIMER                                                                 10/03/2025 11:49:26 PAGE 2   

  55   2              second++;
  56   2              
  57   2              if(second >= 60)
  58   2              {
  59   3                  second = 0;
  60   3                  minute++;
  61   3                  
  62   3                  if(minute >= 60)
  63   3                  {
  64   4                      minute = 0;
  65   4                      hour++;
  66   4                      
  67   4                      if(hour >= 24)
  68   4                      {
  69   5                          hour = 0;
  70   5                      }
  71   4                  }
  72   3              }
  73   2              
  74   2              time_update = 1;    // 设置时间更新标志
  75   2          }
  76   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =     96    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      5    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =      1    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
